// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Employee {
  id                           String                 @id @default(cuid())
  priority                     Priority
  reviewed                     Boolean
  email                        String                 @unique
  salaries                     Salary[]
  deelEmployee                 DeelEmployee?
  keeperTestFeedback           KeeperTestFeedback[]   @relation("employee")
  checkIn30DaysScheduled       Boolean
  checkIn60DaysScheduled       Boolean
  checkIn80DaysScheduled       Boolean
  proposedHires                ProposedHire[]         @relation("manager")
  proposedHiresAsTalentPartner ProposedHire[]
  keeperTestFeedbackSubmitted  KeeperTestFeedback[]   @relation("manager")
  salaryDeviationStatus        SalaryDeviationStatus?
  salaryDeviationCheckedAt     DateTime               @default(now())
}

enum SalaryDeviationStatus {
  IN_SYNC
  DEVIATED
}

model DeelEmployee {
  id                    String         @id
  name                  String
  title                 String
  team                  String
  workEmail             String?        @unique
  personalEmail         String?
  managerId             String?
  manager               DeelEmployee?  @relation("manager", fields: [managerId], references: [id])
  directReports         DeelEmployee[] @relation("manager")
  topLevelManagerId     String?
  topLevelManager       DeelEmployee?  @relation("topLevelManager", fields: [topLevelManagerId], references: [id])
  topLevelDirectReports DeelEmployee[] @relation("topLevelManager")
  employee              Employee?      @relation(fields: [workEmail], references: [email])
  startDate             DateTime
}

enum Priority {
  low
  high
  medium
  pushed_to_next_quarter
  filled
}

model Salary {
  id                      String   @id @default(cuid())
  timestamp               DateTime @default(now())
  country                 String
  area                    String
  locationFactor          Float
  level                   Float
  step                    Float
  benchmark               String
  benchmarkFactor         Float
  totalSalary             Float
  bonusPercentage         Float    @default(0)
  bonusAmount             Float    @default(0)
  changePercentage        Float
  changeAmount            Float
  exchangeRate            Float
  localCurrency           String
  totalSalaryLocal        Float
  amountTakenInOptions    Float
  actualSalary            Float
  actualSalaryLocal       Float
  equityRefreshPercentage Float    @default(0)
  equityRefreshAmount     Float    @default(0)
  equityRefreshGranted    Boolean  @default(true)
  employmentCountry       String?
  employmentArea          String?
  notes                   String
  employeeId              String
  synced                  Boolean  @default(true)
  communicated            Boolean  @default(false)
  employee                Employee @relation(fields: [employeeId], references: [id])
}

enum DriverOrPassenger {
  DRIVER
  PASSENGER
}

enum KeeperTestRecommendation {
  STRONG_HIRE_ON_TRACK_TO_PASS_PROBATION
  AVERAGE_HIRE_NEED_TO_SEE_IMPROVEMENTS
  NOT_A_FIT_NEEDS_ESCALATING
}

model KeeperTestFeedback {
  id                    String                    @id @default(cuid())
  title                 String
  employeeId            String
  employee              Employee                  @relation("employee", fields: [employeeId], references: [id])
  managerId             String
  manager               Employee                  @relation("manager", fields: [managerId], references: [id])
  wouldYouTryToKeepThem Boolean
  whatMakesThemValuable String
  driverOrPassenger     DriverOrPassenger
  proactiveToday        Boolean
  optimisticByDefault   Boolean
  areasToWatch          String
  recommendation        KeeperTestRecommendation?
  sharedWithTeamMember  Boolean
  timestamp             DateTime                  @default(now())
}

enum CyclotronQueueName {
  send_keeper_test
  receive_keeper_test_results
  dead_letter
}

enum CyclotronJobState {
  running
  available
  failed
}

model CyclotronJob {
  id             String             @id @default(cuid())
  created        DateTime           @default(now())
  scheduled      DateTime           @default(now())
  queue_name     CyclotronQueueName
  lock_id        String?
  state          CyclotronJobState  @default(available)
  last_heartbeat DateTime           @default(now())
  data           Json
  failure_count  Int                @default(0)
}

model User {
  id            String    @id
  name          String
  email         String
  emailVerified Boolean   @default(false)
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @default(now()) @updatedAt
  sessions      Session[]
  accounts      Account[]

  role       String?
  banned     Boolean?  @default(false)
  banReason  String?
  banExpires DateTime?

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  impersonatedBy String?

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@map("verification")
}

model ProposedHire {
  id             String     @id @default(cuid())
  title          String
  managerId      String
  manager        Employee   @relation("manager", fields: [managerId], references: [id])
  talentPartners Employee[]
  priority       Priority
  hiringProfile  String
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @default(now()) @updatedAt
}
